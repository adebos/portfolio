"use strict";function addLink(){var e=document.getElementsByTagName("body")[0],t=window.getSelection(),i='<p>Источник: <a href="'+document.location.href+'">'+document.location.href+"</a></p>",a=t+i,o=document.createElement("div");o.style.position="absolute",o.style.left="-99999px",e.appendChild(o),o.innerHTML=a,t.selectAllChildren(o),window.setTimeout(function(){e.removeChild(o)},0)}function hideBlock(){var e=$(".fixed");$("body").scrollTop()>=300?e.fadeIn():e.fadeOut()}function uploadFile(e){e.type.match("image/jpeg")||e.type.match("image/png")?($loader.show(),image.src=URL.createObjectURL(e),uploadedFileName=e.name.split(".").shift()):alert("Поддерживаются только файлы jpg и png")}$("a.scrollto").click(function(){return elementClick=$(this).attr("href"),destination=$(elementClick).offset().top+16,$("html:not(:animated),body:not(:animated)").animate({scrollTop:destination},1100),!1}),document.body.oncontextmenu=function(e){return!1},document.oncopy=addLink,$(window).scroll(hideBlock),$(".jsAppPopup").click(function(e){e.preventDefault(),$(".jsPopup").bPopup()}),$(".js-form").submit(function(){var e=$(this);return $.ajax({type:"POST",url:"mail/mail.php",data:e.serialize()}).done(function(){e.hide(),$(".success").show(),setTimeout(function(){e.trigger("reset")},1e3)}),!1});var $loader=$("#loader"),$filters=$("#filters"),$photoBox=$("#photo-box"),$filePicker=$("#file-picker"),$label=$photoBox.find(".label"),$downloadLink=$("#download-link"),currentPreset="original",uploadedFileName="image",image=new Image,maxWidth=$photoBox.width(),maxHeight=$photoBox.height(),imageWidth=maxWidth,imageHeight=maxHeight;image.onload=function(){var e=this.width,t=this.height;if(e>=maxWidth||t>=maxHeight)if(e>t){var i=e/maxWidth;imageWidth=maxWidth,imageHeight=t/i}else{var a=t/maxHeight;imageHeight=maxHeight,imageWidth=e/a}else imageWidth=e,imageHeight=t;$label.hide(),$filters.addClass("active"),$filters.find(".preset").first().trigger("click");var o=$photoBox.find("canvas"),n=$("<canvas>").addClass("photo").attr({id:"photo",width:imageWidth,height:imageHeight}).css({width:o.width()||"0px",heigth:o.height()||"0px"});o.remove(),$photoBox.append(n);var r=n[0].getContext("2d");r.drawImage(this,0,0,imageWidth,imageHeight),n.css({width:imageWidth+"px",height:imageHeight+"px"}),$loader.hide()},$photoBox.on("dragenter",function(e){$(e.target).addClass("dragenter over"),e.preventDefault()}).on("dragleave",function(e){$(e.target).removeClass("dragenter over"),e.preventDefault()}).on("dragover",function(e){e.preventDefault()}).on("drop",function(e){$(e.target).removeClass("dragenter over"),e.originalEvent.dataTransfer.files.length&&uploadFile(e.originalEvent.dataTransfer.files[0]),e.preventDefault()}).on("click",function(e){$filePicker.trigger("click")}),$filePicker.on("change",function(e){e.target.files.length&&uploadFile(e.target.files[0])}),$filters.on("click",".preset",function(e){var t=$(e.target),i=t.data("preset");$(".preset").removeClass("active"),t.addClass("active"),Caman("#photo",function(){this.reset(),$downloadLink.removeClass("show"),currentPreset=i,"original"!==i&&(this[i](),this.render(),$downloadLink.addClass("show"))}),e.preventDefault()}),Caman.Event.listen("processStart",function(e){$loader.show()}),Caman.Event.listen("renderFinished",function(){$loader.hide()}),$downloadLink.on("click",function(e){var t=e.target,i=document.getElementById("photo");t.href=i.toDataURL(),t.download=uploadedFileName+"-"+currentPreset+".png"});var flagInit=!1;window.onresize=function(){document.body.clientWidth>=851?$(".owl-carousel").removeClass("owl-carousel-filtr"):($(".owl-carousel").addClass("owl-carousel-filtr"),flagInit||($(".owl-carousel-filtr").owlCarousel({loop:!1,nav:!0,dots:!1,navText:['<i class="icon icon-arr_l"></i>','<i class="icon icon-arr_r"></i>'],autoplay:!1,responsive:{0:{items:2},420:{items:3},600:{items:5},761:{items:7}}}),flagInit=!0))};